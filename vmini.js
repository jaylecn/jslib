(function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.vmini=t()})(this,function(){var e="vmini-video";function t(e){return document.createElement(e)}function n(e,n,i){if("string"==typeof e){var o=e;(e=t(i||"div")).className=o,n&&(e.innerHTML=n)}this.el=e}n.prototype={on:function(e,t,n){Array.isArray(e)||(e=[e]);var i=this.el;return e.forEach(function(e){i.addEventListener(e,t,n)}),this},html:function(e){return this.el.innerHTML=e,this},hide:function(e){return this.el.style.display=e||"none",this},show:function(e){return this.el.style.display=e||"",this},find:function(e){var t=this.el.querySelectorAll(e);return t.length>1?t:a(t[0])}};var i,o=null;function r(e){if(null===o){var t=navigator.platform.toLowerCase();o=(t.indexOf("iphone")>-1||t.indexOf("ipad")>-1)&&e.webkitEnterFullScreen}return o}function l(e){var t=Math.floor(e/60),n=Math.round(e-60*t);return(t>9?"":"0")+t+":"+(n>9?"":"0")+n}function a(t,i,o){return new n(t="string"==typeof t?e+"-"+t:t,i,o)}function s(n,i){var o,l=t("video"),s={width:"100%",height:"100%",preload:"none",playsinline:!0,"webkit-playsinline":!0,"x-webkit-airplay":!0,poster:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",src:n};for(o in s)l.setAttribute(o,s[o]);return function(t,n){var i=!1,o=t.el,l=r(o),a=function(e,t){Object.defineProperty(o,e,t)},s=function(){o.dispatchEvent(new Event("fullchange"))};return a("isFull",{get:function(){return l?this.webkitDisplayingFullscreen:i}}),a("enterFull",{value:function(){l?this.webkitEnterFullScreen():(i=!0,n.className=e+" full"),s()}}),a("exitFull",{value:function(){l?this.webkitExitFullscreen():(i=!1,n.className=e,s())}}),l&&t.on("webkitendfullscreen",s),t}(a(l),i)}return function(t,o,d){!function(){if(!i){i=!0;var t='_{position:relative;width:100%;height:100%;font-family:Helvetica Neue}_.full{position:fixed;z-index:9999;width:100vw;height:100vh;left:0;top:0}_ button{border:none;margin:0;padding:0;outline:none;background:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}_ svg{width:100%;height:100%;pointer-events:none}_-loading,button_-play{position:absolute;z-index:3;width:80px;height:80px;color:#fff;top:50%;left:50%;margin-top:-40px;margin-left:-40px}button_-play{background:rgba(0,0,0,.5);border-radius:8px;z-index:2}_-poster,_-tips{position:absolute;z-index:4;width:100%;height:100%;left:0;top:0}_-poster{z-index:1;background-color:#000;background-repeat:no-repeat;background-position:center;background-size:cover}_-tips{display:flex;align-items:center;justify-content:center;color:#fff;font-size:14px}_-tips dl{width:118px;text-align:center;background:rgba(0,0,0,.5);border-radius:6px;padding:10px 0;margin:0}_-tips dd{position:relative;height:4px;margin:8px 10px 0;background:#000;border-radius:2px;overflow:hidden}_-tips dd i{display:block;position:absolute;width:100%;height:100%;top:0;left:-100%;background:#f60;border-radius:2px}_-controller{position:absolute;z-index:5;left:0;right:0;bottom:0;height:40px;background:rgba(0,0,0,.15);display:flex;user-select:none;-webkit-user-select:none}_-controller span{display:flex;height:100%;align-items:center;justify-content:center;font-size:13px;color:#fff;width:41px;text-align:center;padding:0 0 0 10px}_-controller span:first-of-type{padding:0 10px 0 0}_-button{position:relative;z-index:3;width:40px;height:40px;color:#fff}_-button:active{color:#f8f8f8}_-button svg{position:absolute;left:0;top:0}_-process{flex:1;position:relative}_-bufferd{position:absolute;z-index:1;width:100%;height:4px;left:0;top:18px;border-radius:4px;background:#dcdcdc;color:rgba(255,102,0,0.25);overflow:hidden}_-bufferd svg{position:absolute;left:0;top:0;z-index:2}_-bufferd i{position:absolute;width:100%;height:100%;top:0;right:100%;background:#fff}_-percent{position:absolute;z-index:2;width:100%;height:40px;left:-20px;top:0}_-percent button{width:40px;height:40px;display:flex;align-items:center;justify-content:center}_-percent button::after{content:"";display:block;width:14px;height:14px;background:#fff;border-radius:50%}_-player,_-player video{display:block;position:relative;width:100%;height:100%;background:#000;overflow:hidden}_-player::after{display:block;position:absolute;content:"";left:0;top:0;right:0;bottom:0}'.replace(/_/g,"."+e),n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t)),n.appendChild(o)}}();var u,p=new n(e),c={};for(u in c.loading=function(){for(var e='<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">',t=0;t<12;t++)e+='<g transform="rotate('+30*t+' 50 50)"><rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="currentColor"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="'+.083*(t-12)+'s" repeatCount="indefinite"></animate></rect></g>';return a("loading",e+"</g>")}().hide(),c.plays=a("play",'<svg viewbox="0 0 40 40"><path fill="currentColor" stroke="currentColor" stroke-linejoin="round" stroke-width="4" d="M 11 11 L 29 20 L 11 29 Z"/></svg>',"button"),c.tips=a("tips","<dl><dt><b>00:00</b> / <b>00:00</b></dt><dd><i></i></dd></dl>").hide(),c.controller=a("controller",'<button class="'+e+'-button"><svg viewbox="0 0 40 40"><path fill="currentColor" stroke="currentColor" stroke-linejoin="round" stroke-width="4" d="M 11 11 L 29 20 L 11 29 Z"/></svg><svg style="opacity:0" viewbox="0 0 40 40"><path fill="currentColor" d="M 9 10 L 17 10 L 17 30 L 9 30 Z M 23 10 L 31 10 L 31 30 L 23 30 Z"/></svg></button><span>00:00</span><div class="'+e+'-process"><div class="'+e+'-bufferd"><i></i></div><div class="'+e+'-percent"><button></button></div></div><span>00:00</span><button class="'+e+'-button"><svg viewbox="0 0 45 40"><path fill="currentColor" d="M 7 7 L 17 7 L 17 10 L 10 10 L 10 17 L 7 17 Z M 23 7 L 33 7 L 33 17 L 30 17 L 30 10 L 23 10 Z M 7 23 L 10 23 L 10 30 L 17 30 L 17 33 L 7 33 Z M 33 23 L 33 33 L 23 33 L 23 30 L 30 30 L 30 23 Z"/></svg><svg style="opacity:0" viewbox="0 0 45 40"><path fill="currentColor" d="M 7 14 L 7 17 L 17 17 L 17 7 L 14 7 L 14 14 Z M 23 7 L 26 7 L 26 14 L 33 14 L 33 17 L 23 17 Z M 7 23 L 17 23 L 17 33 L 14 33 L 14 26 L 7 26 Z M 23 23 L 33 23 L 33 26 L 26 26 L 26 33 L 23 33 Z"/></svg></button>'),c.player=a("player"),c)p.el.appendChild(c[u].el);for(c.poster=d?a("poster"):null,c.poster&&(c.poster.el.style.backgroundImage="url("+d+")",p.el.appendChild(c.poster.el)),c.media=s(o,p.el),c.player.el.appendChild(c.media.el),c.video=p,function(t){var n=t.media.el,i=t.controller.find("button");t.toggle=a(i[0]),t.seek=a(i[1]),t.full=a(i[2]);var o,s,d,u,p=t.toggle.find("svg"),c=t.full.find("svg"),f=t.tips.find("b"),h=a(f[0]),g=a(f[1]),b=t.tips.find("dd"),v=b.find("i"),y=t.controller.find("."+e+"-process"),m=y.find("."+e+"-percent"),x=t.controller.find("span"),L=a(x[0]),w=a(x[1]),A=y.find("."+e+"-bufferd"),k=A.find("i"),M=!1,C=function(e){M!==e&&(M=e,t.loading.show(e?"":"none"))};t.media.on("progress",function(){if(!o){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("viewBox","0 0 100 8"),t.setAttribute("preserveAspectRatio","none"),(o=document.createElementNS(e,"path")).setAttribute("fill","currentColor"),t.appendChild(o),A.el.appendChild(t)}var i,r,l,a=n.buffered,s="";for(i=0;i<a.length;i++)r=Math.floor(1e3*a.start(i)/n.duration)/10,(l=Math.floor(1e3*a.end(i)/n.duration)/10)>r&&(s+="M "+r+" 0 L "+l+" 0 L "+l+" 8 L "+r+" 8 Z ");o.setAttribute("d",s)}).on("durationchange",function(){var e=l(n.duration);g.html(e),w.html(e)}).on("timeupdate",function(){var e=l(n.currentTime),t=Math.round(100*n.currentTime/n.duration);if(e!==s&&L.html(s=e),!isNaN(t)&&(t=Math.max(0,Math.min(t,100)))!==d){var i="translateX("+(d=t)+"%)";k.el.style.transform=i,m.el.style.transform=i}}).on("play",function(){t.poster&&(t.video.el.removeChild(t.poster.el),t.poster=null),t.plays.hide(),p[0].style.opacity=0,p[1].style.opacity=1}).on("pause",function(){u||(t.plays.show(),p[0].style.opacity=1,p[1].style.opacity=0)}).on(["stalled","waiting"],function(){C(!0)}).on(["canplay","playing"],function(){C(!1)}),r(n)||t.media.on("fullchange",function(){c[0].style.opacity=this.isFull?0:1,c[1].style.opacity=this.isFull?1:0});var _,E,T,N,z,Z,F,S,j,B=t.controller.el.style,X=function(){_&&(clearTimeout(_),_=null)},R=function(e){B.pointerEvents=e?"none":"auto",B.transition=e?"opacity ease-out .6s":"",B.opacity=e?0:1,e||Y(!0,2500)},Y=function(e,t){if(X(),void 0===e&&(e=Number(B.opacity)>0),e||!n.paused)return t?void(_=setTimeout(function(){R(e)},t)):R(e)},O=["plays","toggle","seek","full"];t.video.on("touchstart",function(e){S=null,u=!1,j=null,E=null,T=e.target,O.forEach(function(e){T===t[e].el&&(E=e)}),E&&"seek"!==E||("seek"===E?N=y.el.getBoundingClientRect():n.paused||(N=e.touches[0]))}).on("touchmove",function(e){var i="seek"===E;if(N&&(!E||i)){e.preventDefault();var o=null;if(i)X(),o=(e.changedTouches[0].pageX-N.left)/N.width*n.duration;else if(u){var r=e.changedTouches[0].pageX-z.changedTouches[0].pageX,a=e.timeStamp-z.timeStamp,s=Math.abs(r/a);s=Math.max(.05,Math.min(s,.55)),o=j+(1+.1*(s/.05-1)*(F-1))*Z*r,z=e}else{var d=e.changedTouches[0];if(Math.abs(d.pageY-N.pageY)<10&&Math.abs(d.pageX-N.pageX)>10){var p,c=n.offsetWidth,f=n.duration;Z=Math.min(120,f)/c,p=Math.min(1200,f)/c,F=p/Z,z=e,o=n.currentTime}}if(null!==(j=null===o?null:Math.max(0,Math.min(o,n.duration)))&&!isNaN(j)){i&&null===S&&((S=n.paused)||n.pause()),u||(u=!0,t.tips.show(),b.show(i?"none":"")),h.html(l(j));var g=Math.round(100*j/n.duration);g="translateX("+(g=Math.max(0,Math.min(g,100)))+"%)",i?(k.el.style.transform=g,m.el.style.transform=g):v.el.style.transform=g}}},{passive:!1}).on("touchend",function(e){if(E&&"seek"!==E){var i=e.changedTouches[0],o=i.pageX,r=i.pageY,l=T.getBoundingClientRect();if(o<l.left||o>l.right||r<l.top||r>l.bottom)return;if("plays"===E)n.play();else if("toggle"===E)try{n.paused?n.play():n.pause()}catch(e){}else"full"===E&&(n.isFull?n.exitFull():n.enterFull())}else if(u){if(u=!1,null===j)return;n.currentTime=j,j=null,t.tips.hide(),null!==S&&(n.play(),S=null),Y(!0,2500)}else Y()}),Y(!0),t.poster||n.load()}(c),"string"==typeof t&&(t=document.querySelector(t));t.firstChild;)t.removeChild(t.firstChild);return t.appendChild(p.el),c.media.el}});
